<!-- 
  Enhanced Main Application Layout
  Features a modern, high-contrast UI with resizable panels and improved visual hierarchy
-->
<div class="app-container">
  
  <!-- App Header - Contains branding and upload controls -->
  <header class="app-header">
    <div class="header-content">

      <!-- Document Info (shows when a document is loaded) -->
      <div class="document-info" *ngIf="activeDocument">
        <div class="document-name">
          <mat-icon>description</mat-icon>
          <span>{{ activeDocument.fileName }}</span>
        </div>
        <div class="document-meta">
          <span class="document-date">Processed: {{ activeDocument.processedDate | date:'medium' }}</span>
          <span class="document-size">{{ formatFileSize(activeDocument.fileSize) }}</span>
        </div>
      </div>
      
      <!-- Upload Controls -->
      <div class="upload-controls" style="display: none;">
        <button mat-raised-button color="primary" (click)="fileInput.click()" class="upload-btn">
          <mat-icon>upload_file</mat-icon>
          Upload Meeting Document
        </button>
        <input #fileInput type="file" hidden accept=".pdf" (change)="onFileSelected($event)">
      </div>
    </div>
  </header>

  <!-- Main Content Area - Resizable two-panel layout -->
  <main class="app-main">
    
    <!-- Panels Container with Resizable Feature -->
    <div class="panels-container">
      <!-- Left Panel - Chat Interface -->
      <section class="chat-panel" [style.width.px]="chatPanelWidth">
        <!-- Chat Header -->
        <div class="panel-header">
          <h2>
            <mat-icon>chat</mat-icon>
            Ask About This Meeting
          </h2>
          <div class="panel-controls">
            <!-- Panel size controls -->
            <button mat-icon-button 
                    matTooltip="Minimize panel"
                    (click)="minimizeChatPanel()"
                    *ngIf="!isChatMinimized">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <button mat-icon-button 
                    matTooltip="Maximize panel"
                    (click)="maximizeChatPanel()"
                    *ngIf="isChatMinimized">
              <mat-icon>chevron_right</mat-icon>
            </button>
          </div>
        </div>
        
        <!-- Chat Messages Container -->
        <div class="chat-messages" #chatContainer *ngIf="!isChatMinimized">
          <!-- Loading Indicator -->
          <div class="loading-indicator" *ngIf="isLoading">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Processing your request...</p>
          </div>
          
          <!-- Welcome Message (when no document is loaded) -->
          <div class="welcome-message" *ngIf="!activeDocument && !isLoading">
            <mat-icon class="welcome-icon">tips_and_updates</mat-icon>
            <h3>Welcome to MeetingLens</h3>
            <p>Upload a meeting document to get started. Once processed, you can ask questions about the meeting content.</p>
          </div>
          
          <!-- Chat Messages -->
          <ng-container *ngIf="activeDocument && !isLoading">
            <div class="message-container" *ngFor="let message of chatMessages">
              <div class="message" [ngClass]="{'user-message': message.isUser, 'ai-message': !message.isUser}">
                <div class="message-avatar">
                  <mat-icon>{{ message.isUser ? 'person' : 'smart_toy' }}</mat-icon>
                </div>
                <div class="message-content">
                  <div class="message-text" [innerHTML]="message.content"></div>
                  <div class="message-time">{{ message.timestamp | date:'shortTime' }}</div>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
        
        <!-- Chat Input Area -->
        <div class="chat-input-container" *ngIf="!isChatMinimized">
          <mat-form-field appearance="outline" class="chat-input">
            <mat-label>Ask a question about the meeting...</mat-label>
            <input matInput 
                   type="text" 
                   [(ngModel)]="chatInputText" 
                   (keyup.enter)="sendChatMessage()"
                   [disabled]="!activeDocument || isLoading">
          </mat-form-field>
          <button mat-icon-button 
                  class="send-button" 
                  [disabled]="!chatInputText || !activeDocument || isLoading"
                  (click)="sendChatMessage()" 
                  matTooltip="Send message">
            <mat-icon>send</mat-icon>
          </button>
        </div>
      </section>

      <!-- Resizer Handle -->
      <div class="panel-resizer" 
           (mousedown)="startResize($event)"
           [class.active]="isResizing">
        <div class="resizer-handle"></div>
      </div>

      <!-- Right Panel - Dynamic Components -->
      <section class="components-panel">
        <!-- Components Header -->
        <div class="panel-header">
          <h2>
            <mat-icon>dashboard</mat-icon>
            Meeting Summary
          </h2>
          <div class="panel-actions">
            <!-- View Controls -->
            <div class="view-controls">
              <button mat-icon-button matTooltip="Grid View" [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')">
                <mat-icon>grid_view</mat-icon>
              </button>
              <button mat-icon-button matTooltip="List View" [class.active]="viewMode === 'list'" (click)="setViewMode('list')">
                <mat-icon>view_list</mat-icon>
              </button>
              <button mat-icon-button matTooltip="Card View" [class.active]="viewMode === 'card'" (click)="setViewMode('card')">
                <mat-icon>view_module</mat-icon>
              </button>
            </div>
            <!-- Refresh Button -->
            <button mat-icon-button matTooltip="Refresh components" (click)="refreshComponents()" *ngIf="activeDocument">
              <mat-icon>refresh</mat-icon>
            </button>
          </div>
        </div>
        
        <!-- Components Content Area -->
        <div class="components-content" [ngClass]="viewMode">
          <!-- Empty State (when no document is loaded) -->
          <div class="empty-state" *ngIf="!activeDocument && !isLoading">
            <mat-icon class="empty-icon">description</mat-icon>
            <h3>No Document Loaded</h3>
            <p>Upload a meeting document to see the AI-generated summary components.</p>
            <button mat-raised-button color="primary" (click)="fileInput.click()" class="upload-btn-alt">
              Upload Document
            </button>
          </div>
          
          <!-- Loading State -->
          <div class="loading-state" *ngIf="isLoading">
            <div class="loading-animation">
              <mat-spinner diameter="60"></mat-spinner>
            </div>
            <h3>Analyzing Document</h3>
            <p>Our AI is processing your meeting document and generating interactive components...</p>
            <div class="processing-status" *ngIf="processingProgress > 0">
              <mat-progress-bar mode="determinate" [value]="processingProgress"></mat-progress-bar>
              <span class="progress-text">{{ processingProgress }}% complete</span>
            </div>
          </div>
          
          <!-- Dynamic Renderer (only visible when document is loaded) -->
          <div class="renderer-container" *ngIf="activeDocument && !isLoading">
            <app-dynamic-renderer
              [aguiMessage]="aguiMessage"
              [showLoading]="isComponentsLoading"
              [enableAnimations]="true"
              (componentInteraction)="onComponentInteraction($event)"
              (componentDataChange)="onComponentDataChange($event)"
              (renderComplete)="onRenderComplete($event)"
              (renderError)="onRenderError($event)">
            </app-dynamic-renderer>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Status Bar -->
  <footer class="app-footer" *ngIf="activeDocument">
    <div class="footer-content">
      <div class="status-info">
        <span class="status-item">
          <mat-icon>info</mat-icon>
          {{ getComponentStats() }}
        </span>
        <span class="status-item" *ngIf="lastProcessingTime">
          <mat-icon>timer</mat-icon>
          Processing time: {{ lastProcessingTime }}s
        </span>
      </div>
      <div class="footer-actions">
        <button mat-button class="clear-btn" (click)="clearDocument()" matTooltip="Clear current document">
          <mat-icon>delete</mat-icon>
          Clear
        </button>
      </div>
    </div>
  </footer>
</div>